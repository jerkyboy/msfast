<?xml version="1.0" encoding="utf-8" ?>
<config>
	<global>
		<PageDataCollector>
			<![CDATA[
    function alert() {return true;}
    function confirm() {return true;} 
    function onerror(){return true;}
    window.onerror = function(){return true;}
    
		function PageDataCollector(_tid,_totalp,_rurl, _reurl, _nurl, _neurl)
		{
		    this.requestUrl = _rurl;
		    this.requestEncodedUrl = _reurl;
			  this.nextURL = _nurl;
		    this.testId = _tid;
		    this.breaks = _totalp;
			  this.nextEncodedURL = _neurl;
			  this._collectors = [];
			
			  this._callHandler = function(_fn,_ar){
				  for(var i = 0 ; i < this._collectors.length; i++){
					  try{
						  if(this._collectors[i][_fn]){
							  this._collectors[i][_fn](_ar);
						  }
					  }catch(e){}
				  }
			  };
			
			  this._redirectPage = function(_u){
				  try
				  {
					  window.external.ExecuteJs("redirect", _u);
				  }
				  catch(e)
				  {
				  }
			  };
			
			this._doNext = function(){
				if(this.nextURL && this.nextURL != "" && this.nextURL != top.location.href){
					this._redirectPage(this.nextURL);
				}else{
					this.onTestEnded();
				}
			};
			
			this._checkIfAllDone = function(){
				var alldone = 0;
				var inst = this;
				alldone = setInterval(function(){
					for(var i = 0 ; i < inst._collectors.length; i++){
						try{
							if(inst._collectors[i].isFinished){
								if(inst._collectors[i].isFinished() == false){
									return;
								}
							}
						}catch(e){}
					}
					clearInterval(alldone);
					inst._doNext();
				},250);
			};
			
			this.addCollector = function(_ls){
				this._collectors.push(_ls);
			};
			
      this.onStartingTest = function(){
				this._callHandler("onStartingTest");
        try{window.external.ExecuteJs("signal_test_started",$pdc.testId);}catch(e){}
        this._redirectPage(this.nextURL);
			};
      
      this.onTestEnded = function(){
				this._callHandler("onTestEnded");
        try{window.external.ExecuteJs("signal_test_ended",$pdc.testId);}catch(e){}
      };
      
      this.onLoadingFirstCollectionPage = function(){
				this._callHandler("onLoadingFirstCollectionPage");
				this._redirectPage(this.nextURL);
			};
			
			this.onInit = function(){this._callHandler("onInit");};
			this.onReadyState = function(s){this._callHandler("onReadyState",{state:s});};
			this.onStartDocument = function(){this._callHandler("onStartDocument");};
			this.onStartHtml = function(){this._callHandler("onStartHtml");};
			this.onStartHead = function(){this._callHandler("onStartHead");};
			this.onEndHead = function(){this._callHandler("onEndHead");};
			this.onStartBody = function(){this._callHandler("onStartBody");};
			this.onSegment = function(s){this._callHandler("onSegment",{segmentId:s});};
			this.onEndBody = function(){this._callHandler("onEndBody");};
			this.onEndHtml = function(){this._callHandler("onEndHtml");};
      this.onEndDocument = function(){this._callHandler("onEndDocument");this._checkIfAllDone();};
		}
    
    function msfOnReadyState(st){try{$pdc.onReadyState(st);}catch(e){}}
    ]]>
		</PageDataCollector>
		
		<PageDataCollector_Constructor><![CDATA[var $pdc = new PageDataCollector({0},{1},"{2}","{3}","{4}","{5}");]]></PageDataCollector_Constructor>
		<PageDataCollector_Event_OnInit><![CDATA[$pdc.onInit();]]></PageDataCollector_Event_OnInit>

    <PageDataCollector_Event_OnStartingTest><![CDATA[setTimeout("$pdc.onStartingTest();",200);]]></PageDataCollector_Event_OnStartingTest>
    <PageDataCollector_Event_OnLoadingFirstCollectionPage><![CDATA[setTimeout("$pdc.onLoadingFirstCollectionPage();",200);]]></PageDataCollector_Event_OnLoadingFirstCollectionPage>
    
    <PageDataCollector_Event_OnStartDocument ><![CDATA[$pdc.onStartDocument();]]></PageDataCollector_Event_OnStartDocument>
		<PageDataCollector_Event_OnStartHtml><![CDATA[$pdc.onStartHtml();]]></PageDataCollector_Event_OnStartHtml>
		<PageDataCollector_Event_OnStartHead><![CDATA[$pdc.onStartHead();]]></PageDataCollector_Event_OnStartHead>
		<PageDataCollector_Event_OnEndHead><![CDATA[$pdc.onEndHead();]]></PageDataCollector_Event_OnEndHead>
		<PageDataCollector_Event_OnStartBody><![CDATA[$pdc.onStartBody();]]></PageDataCollector_Event_OnStartBody>
		<PageDataCollector_Event_OnSegment><![CDATA[$pdc.onSegment({0});]]></PageDataCollector_Event_OnSegment>
		<PageDataCollector_Event_OnEndBody><![CDATA[$pdc.onEndBody();]]></PageDataCollector_Event_OnEndBody>
		<PageDataCollector_Event_OnEndHtml><![CDATA[$pdc.onEndHtml();]]></PageDataCollector_Event_OnEndHtml>
		<PageDataCollector_Event_OnEndDocument><![CDATA[$pdc.onEndDocument();]]></PageDataCollector_Event_OnEndDocument>

    <PageDataCollector_Script_IsFinished><![CDATA[$pdc.addCollector({{isFinished : function(e){{ {0} }}}});]]></PageDataCollector_Script_IsFinished>
    <PageDataCollector_Script_OnStartingTest><![CDATA[$pdc.addCollector({{onStartingTest : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnStartingTest>
    <PageDataCollector_Script_OnTestEnded><![CDATA[$pdc.addCollector({{onTestEnded : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnTestEnded>
    <PageDataCollector_Script_OnLoadingFirstCollectionPage><![CDATA[$pdc.addCollector({{onLoadingFirstCollectionPage : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnLoadingFirstCollectionPage>
    <PageDataCollector_Script_OnInit><![CDATA[$pdc.addCollector({{onInit : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnInit>
    <PageDataCollector_Script_OnStartDocument><![CDATA[$pdc.addCollector({{onStartDocument : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnStartDocument>
    <PageDataCollector_Script_OnStartHtml><![CDATA[$pdc.addCollector({{onStartHtml : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnStartHtml>
    <PageDataCollector_Script_OnStartHead><![CDATA[$pdc.addCollector({{onStartHead : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnStartHead>
    <PageDataCollector_Script_OnEndHead><![CDATA[$pdc.addCollector({{onEndHead : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnEndHead>
    <PageDataCollector_Script_OnStartBody><![CDATA[$pdc.addCollector({{onStartBody : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnStartBody>
    <PageDataCollector_Script_OnSegment><![CDATA[$pdc.addCollector({{onSegment : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnSegment>
    <PageDataCollector_Script_OnEndBody><![CDATA[$pdc.addCollector({{onEndBody : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnEndBody>
    <PageDataCollector_Script_OnEndHtml><![CDATA[$pdc.addCollector({{onEndHtml : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnEndHtml>
    <PageDataCollector_Script_OnEndDocument><![CDATA[$pdc.addCollector({{onEndDocument : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnEndDocument>
    <PageDataCollector_Script_OnReadyState><![CDATA[$pdc.addCollector({{onReadyState : function(e){{ {0} }}}});]]></PageDataCollector_Script_OnReadyState>

    <EmptyHTML>
      <![CDATA[<html>
				<head>
					<script>
					{0}
					</script>
				</head>
				<body>
				</body>
				<script>
          {1}
				</script>
			</html>]]>
		</EmptyHTML>
    
	
</global>
</config>
