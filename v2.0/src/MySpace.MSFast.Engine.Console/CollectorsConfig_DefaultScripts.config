<?xml version="1.0" encoding="utf-8" ?>
<config>
  <collectorsgroups>
    <collectorsgroup groupid="0">
      <collector name="Start_Download_Tracking_Using_Proxy">
        <onStartingTest>
          <![CDATA[
            try{
				      var getXMLHttpRequest = function(){
				        if( typeof XMLHttpRequest == "undefined" ){
					        try { return new ActiveXObject("Msxml2.XMLHTTP.6.0") } catch(e) {}
					        try { return new ActiveXObject("Msxml2.XMLHTTP.3.0") } catch(e) {}
					        try { return new ActiveXObject("Msxml2.XMLHTTP") } catch(e) {}
					        try { return new ActiveXObject("Microsoft.XMLHTTP") } catch(e) {}
				        }else{
				          return new XMLHttpRequest();
				        }
				      }
              
				      var client = getXMLHttpRequest();
				      client.open("GET", "/?START_TRACKING=" + $pdc.testId + "~" + $pdc.requestEncodedUrl + "~" + $pdc.nextEncodedURL, false);
				      client.send();
            }catch(e){
            }
    		  ]]>
        </onStartingTest>
      </collector>
      <collector name="Stop_Download_Tracking_Using_Proxy">
        <isFinished>
          <![CDATA[
  				  return window["istriggered_stop_tracker"]; 
          ]]>
        </isFinished>
        <onInit>
          <![CDATA[
  				  window["istriggered_stop_tracker"] = false; 
          ]]>
        </onInit>
        <onEndDocument>
          <![CDATA[
            setTimeout(function(){
              try{
                var getXMLHttpRequest = function(){
                  if( typeof XMLHttpRequest == "undefined" ){
                    try { return new ActiveXObject("Msxml2.XMLHTTP.6.0") } catch(e) {}
                    try { return new ActiveXObject("Msxml2.XMLHTTP.3.0") } catch(e) {}
                    try { return new ActiveXObject("Msxml2.XMLHTTP") } catch(e) {}
                    try { return new ActiveXObject("Microsoft.XMLHTTP") } catch(e) {}
                  }else{
                    return new XMLHttpRequest();
                  }
                }
                var client = getXMLHttpRequest();
                client.open("GET", "/?STOP_TRACKING=" + $pdc.testId + "~" + $pdc.requestEncodedUrl + "~aHR0cDovL21zZmFzdC5jb20=", false);
                client.send();
              }catch(e){                
              }
              window["istriggered_stop_tracker"] = true;
            },15000);
          ]]>
        </onEndDocument>
      </collector>
      <collector name="Start_Browser_Performance_Tracking">
        <onLoadingFirstCollectionPage>
          <![CDATA[
            window.external.ExecuteJs("startperftest","");
          ]]>
        </onLoadingFirstCollectionPage>
      </collector>
      <collector name="Stop_Browser_Performance_Tracking">
        <onEndDocument>
          <![CDATA[
				    window.external.ExecuteJs("endperftest","perfdump_" + $pdc.testId + ".dat");
		      ]]>
        </onEndDocument>
      </collector>
      <collector name="Clear_Browser_Cache">
        <onLoadingFirstCollectionPage>
          <![CDATA[
            window.external.ExecuteJs("clearcache", "");
          ]]>
        </onLoadingFirstCollectionPage>
        <onEndDocument>
          <![CDATA[
            window.external.ExecuteJs("clearcache", "");
          ]]>
        </onEndDocument>
      </collector>
      <collector name="Track_Page_Render_Segments">
        <onInit>
          <![CDATA[  
          window["_collectedRenderData"] = "";
          window["markRenderTest"] = function(_t){ window["_collectedRenderData"] += ((_t) ? _t  : "") + ":" + ((new Date()/1000)*1000) + ";"; }        
          window.onload = function(){window["markRenderTest"]("onload");}
          document.onreadystatechange = function(){
            var rs = document.readyState;
            if(rs == "uninitialized"){	    window["markRenderTest"]("Ready State Uninitialized");
            }else if(rs == "loading"){	    window["markRenderTest"]("Ready State Loading");
            }else if(rs == "loaded"){		    window["markRenderTest"]("Ready State Loaded");
            }else if(rs == "interactive"){  window["markRenderTest"]("Ready State Interactive");
            }else if(rs == "complete"){	    window["markRenderTest"]("Ready State Complete"); }
          }        
        ]]>
        </onInit>
        <onEndHead>
          <![CDATA[ 
            window["markRenderTest"]("onEndHead");
          ]]>
        </onEndHead>
        <onStartBody>
          <![CDATA[ 
            window["markRenderTest"]("onStartBody");
          ]]>
        </onStartBody>
        <onSegment>
          <![CDATA[
            window["markRenderTest"]("onSegment(" + e.segmentId +")");
          ]]>
        </onSegment>
        <onEndBody>
          <![CDATA[
            window["markRenderTest"]("onEndBody");
          ]]>
        </onEndBody>
        <onEndHtml>
          <![CDATA[
            window["markRenderTest"]("onEndHtml");
          ]]>
        </onEndHtml>
        <onEndDocument>
          <![CDATA[ 
            markRenderTest("onEndDocument");
            window.external.ExecuteJs("saveData", _collectedRenderData);
          ]]>
        </onEndDocument>
      </collector>
      <collector name="Progress_Tracker_Render">
        <onSegment><![CDATA[try{window.external.ExecuteJs("onProgress", "0;" + e.segmentId + ";" + $pdc.breaks);}catch(e){}]]></onSegment>
      </collector>
    </collectorsgroup>
    <collectorsgroup groupid="1">
      <collector name="Screenshots_Small">
        <onSegment><![CDATA[try{window.external.ExecuteJs("getSnapshot", ((e && e.segmentId) ? e.segmentId : "x" + Math.round(Math.random()*100000) + "x") + "~248~183~0");}catch(e){}]]></onSegment>
      </collector>
      <collector name="Progress_Tracker_Screenshots">
        <onSegment><![CDATA[try{window.external.ExecuteJs("onProgress", "1;" + e.segmentId + ";" + $pdc.breaks);}catch(e){}]]></onSegment>
      </collector>
    </collectorsgroup>
  </collectorsgroups>
</config>
